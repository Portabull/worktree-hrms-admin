<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Login</title>
    <style>
        /* Reset and global styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #3A4A67, #1D2536);
            color: white;
            overflow-y: auto;
        }

        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #3A4A67, #1D2536);
            z-index: -1;
            animation: gradient 6s infinite alternate;
        }

        @keyframes gradient {
            0% {
                background: linear-gradient(135deg, #3A4A67, #1D2536);
            }
            100% {
                background: linear-gradient(135deg, #1D2536, #3A4A67);
            }
        }

        .container {
            display: flex;
            width: 90%;
            max-width: 1300px;
            height: 700px;
            background: #ffffff;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }

        /* Welcome Section */
        .welcome-section {
            flex: 1;
            background: linear-gradient(135deg, #1F3A57, #4A69BD);
            color: white;
            padding: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: left;
        }

        .welcome-section h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .welcome-section p {
            font-size: 1rem;
            line-height: 1.6;
        }

        /* Login Section */
        .login-section {
            flex: 1;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #ffffff;
            border-radius: 15px;
        }

        .logo-container {
            margin-bottom: 20px;
            text-align: center;
            animation: fadeIn 1s ease;
        }

        .logo-container img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 2px solid #4A69BD;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
        }

        .logo-container img:hover {
            transform: rotate(360deg);
        }

        .login-section h2 {
            font-size: 1.8rem;
            margin-bottom: 30px;
            color: #333;
        }

        .form-group {
            width: 100%;
            max-width: 350px;
            margin-bottom: 20px;
            position: relative;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            padding-left: 40px;
            border: 1px solid #ddd;
            border-radius: 25px;
            font-size: 1rem;
            background: #f9f9f9;
            color: #333;
            transition: box-shadow 0.3s ease;
        }

        .form-group input:focus {
            border-color: #4A69BD;
            outline: none;
            box-shadow: 0 0 10px rgba(74, 105, 189, 0.5);
        }

        .form-group svg {
            position: absolute;
            top: 50%;
            left: 10px;
            transform: translateY(-50%);
            fill: #aaa;
        }

        .checkbox-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            max-width: 350px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .checkbox-container label {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #666;
        }

        .checkbox-container a {
            color: #4A69BD;
            text-decoration: none;
        }

        .checkbox-container a:hover {
            text-decoration: underline;
        }

        .login-btn {
            width: 100%;
            max-width: 350px;
            padding: 12px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(135deg, #1F3A57, #4A69BD);
            color: white;
            font-size: 1rem;
            cursor: pointer;
            transition: background 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
        }

        .login-btn:hover {
            background: linear-gradient(135deg, #4A69BD, #1F3A57);
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(74, 105, 189, 0.5);
        }

        .info-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .info-modal .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            max-width: 90%;
            width: 400px;
        }

        .info-modal .modal-body {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .info-modal .modal-content h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .info-modal .modal-content p {
            color: #555;
            word-wrap: break-word;
        }

        .info-modal .modal-content button {
            padding: 10px 20px;
            background: #4A69BD;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .info-modal .modal-content button:hover {
            background: #1F3A57;
        }

        @media screen and (max-width: 768px) {
            body {
                background: linear-gradient(135deg, #2C3E50, #4A69BD);
            }

            .container {
                flex-direction: column;
                width: 90%;
                max-width: 400px;
                height: auto;
                border-radius: 10px;
                padding: 10px;
                overflow-y: auto;
            }

            .welcome-section {
                display: none;
            }

            .login-section {
                padding: 30px;
                background: #ffffff;
                border-radius: 10px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }

            .logo-container img {
                width: 80px;
            }

            .login-section h2 {
                font-size: 1.6rem;
            }

            .form-group {
                max-width: 100%;
            }

            .checkbox-container {
                max-width: 100%;
            }

            .login-btn {
                max-width: 100%;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }




  /* loader css starts */


 /* Rotate animation for the loader */
    .loading {
      animation: rotate 1s linear infinite;
    }

    /* Keyframes for the rotating animation */
    @keyframes rotate {
      100% {
        transform: rotate(360deg);
      }
    }



.loader-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    visibility: hidden; /* Hide loader by default */
}

.loader {
    border: 8px solid #f3f3f3; /* Light gray */
    border-top: 8px solid #3498db; /* Blue */
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* loader css ends */
    </style>
</head>
<body oncontextmenu="return false;">


<div id="loader" class="loader-overlay">
    <div class="loader"></div>
</div>

<div class="animated-bg"></div>

<div class="info-modal" id="infoModal">
    <div class="modal-content">
        <h3 id="modalTitle">Information</h3>
        <div class="modal-body">
            <p id="modalMessage">This is a sample message.</p>
        </div>
        <button onclick="closeInfoMessage()">Okay</button>
    </div>
</div>

<div class="container">
    <!-- Welcome Section -->
    <div class="welcome-section">
        <h1>Welcome to the HRMS</h1>
        <p>Manage employee records, performance reviews, and more with our secure platform. Login to continue.</p>
    </div>

    <!-- Login Section -->
    <div class="login-section">
        <div class="logo-container">
            <img src="https://worktree-hrms.shop/image/logo.png" alt="Company Logo">
        </div>
        <h2>User Login</h2>
        <form id="loginForm">
            <div class="form-group">
                <input type="text" id="username" placeholder="Username" aria-label="Username" required>
                <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20">
                    <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"></path>
                </svg>
            </div>
            <div class="form-group">
                <input type="password" id="password" placeholder="Password" aria-label="Password" required>
                <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 0 24 24" width="20">
                    <path d="M12 17c1.1 0 2-.9 2-2v-1h2v1c0 2.21-1.79 4-4 4s-4-1.79-4-4v-1h2v1c0 1.1.9 2 2 2zm6-5V8c0-2.21-1.79-4-4-4s-4 1.79-4 4v4H6v10h12V12h-2zm-6-4c0-1.1.9-2 2-2s2 .9 2 2v4h-4V8z"></path>
                </svg>
            </div>

            <div class="checkbox-container">
                <label>
                    <input type="checkbox" id="rememberMe"> Remember
                </label>
                <a href="#">Forgot password?</a>
            </div>
            <button type="button" class="login-btn" onclick="login()">Login</button>
            <br><br>
            <div class="left" hidden>
                <img width="20px" style="margin-top:7px; margin-right:8px" alt="Google sign-in" src="https://worktree-hrms.shop:2029/APIGateway/images/Google__G__Logo.svg.webp">
            </div>
            <br>
            <div class="checkbox-container">
                <a href="#" onclick="goToHelp('VHJvdWJsZXNob290aW5nIExvZ2luIElzc3Vlcw==')">Facing any issue while login?</a>
            </div>
        </form>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/platform/1.3.6/platform.min.js"></script>
<script src="js/security.js"></script>
<script src="js/worktree.js"></script>
<script>

var locationDetails;


    function showErrorMessage(title, message) {
        const modal = document.getElementById('infoModal');
        document.getElementById('modalTitle').innerText = title;
        document.getElementById('modalMessage').innerText = message;
        modal.style.display = 'flex';
    }

    function closeInfoMessage() {
        const modal = document.getElementById('infoModal');
        modal.style.display = 'none';
    }
    document.addEventListener("DOMContentLoaded", function () {
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');

        // Function to hide the mobile keyboard
        function hideKeyboard() {
            document.activeElement.blur();
        }

        // Function to handle Enter key press
        function handleEnterKey(event) {
            if (event.key === "Enter") {
 const modal = document.getElementById('infoModal');
                 if(modal.style.display=="flex"){
                    return;
                 }

                login();
                hideKeyboard();
            }
        }

        // Attach event listener to both input fields
        usernameInput.addEventListener('keydown', handleEnterKey);
        passwordInput.addEventListener('keydown', handleEnterKey);
    });

 document.addEventListener("keydown", function (event) {
        if (event.key === "Enter") {
             const modal = document.getElementById('infoModal');
                if(modal.style.display=="flex"){
                    closeInfoMessage();
                    return;
                }
        }
    });


function startLoader() {
    document.getElementById('loader').style.visibility = 'visible';
    document.body.style.pointerEvents = 'none'; // Disable interaction with the screen
}

window.addEventListener('pageshow', function(event) {
        // Check if the page is loaded from the cache
        if (event.persisted) {
            stopLoader();
        }
    });

function stopLoader() {
    document.getElementById('loader').style.visibility = 'hidden';
    document.body.style.pointerEvents = 'auto'; // Re-enable interaction with the screen
}

    var userNameCache;
    var retryCount = 0;

    function login() {
        const username = document.getElementById('username').value;
        userNameCache = username;
        const password = document.getElementById('password').value;

        if (username && password) {

            startLoader();

            if(locationDetails === undefined && retryCount < 3){
            retryCount++;
             console.log(`Retrying login, attempt #${retryCount}`);
                setTimeout(login, 1000);
                return;
            }

            if(locationDetails === undefined && retryCount >= 3){
             stopLoader();
                 showErrorMessage("Location ERROR","We haven't received your location yet. Please wait a few seconds and try again. Make sure that location permissions are enabled.");
                retryCount = 0;
                return;
            }
            dynamicXhrApi('POST', BASE_URL + 'api/login', { 'Content-Type': 'application/json','latlong': locationDetails,'dd':getDeviceDetails()}, { "userName": username, "password": _0x1a2b3c(password, sec_key_mech) }, afterLogin);
        } else {
         stopLoader();
                 showErrorMessage('Validation Error', 'Please fill in both Username and Password.');
        }
    }

    function afterLogin(xhr,decryptedResponseObj) {
        if (xhr.status == 200) {
        setAsCurrentUser(userNameCache);
                        loginCacheTokenInfo(xhr,decryptedResponseObj);

            window.location.href = "home";
        } else {
            const response = decryptedResponseObj;
              stopLoader();
              showErrorMessage('Login Failed', response.message);
        }
    }

 var token =   getCurrentTokenWithoutRedirect();
   const urlParams = new URLSearchParams(window.location.search);
 if(token!=undefined && urlParams.get('add-new-user')==undefined){
      window.location.href = "home";
 }else if(urlParams.get('add-new-user')==undefined){

var userNameTINFOJson = window.localStorage.getItem(userNameTINFO);



// Initialize an empty array to hold the data
var userNameList = [];

// Check if there is already data in localStorage
if (userNameTINFOJson !== null) {
    // Parse the existing data if it exists
    userNameList = JSON.parse(userNameTINFOJson);
}

 if (isUserNameListValid(userNameList)) {
        window.location.href = 'manage-profile';
    }

 }

 function isUserNameListValid(userNameList) {
    if (userNameList === null || userNameList === undefined || userNameList.length === 0) {
        return false;  // userNameList is either null, undefined, or empty
    }
    return true;  // userNameList is valid and has elements
}

 window.addEventListener('pageshow', function(event) {
        // Check if the page is loaded from the cache
        if (event.persisted) {
            stopLoader();
        }
    });



    getLocation();

function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition, showError, {
      enableHighAccuracy: false,  // Set to true for precise location
      timeout: 15000,  // Timeout after 5 seconds
      maximumAge: 0   // No cached position
    });
  } else {
    console.log("Geolocation is not supported by this browser.");
  }
}

function showPosition(position) {
  const latitude = position.coords.latitude;
  const longitude = position.coords.longitude;
   locationDetails = latitude + ":" + longitude;
   }

function showError(error) {
 stopLoader();
  switch(error.code) {
    case error.PERMISSION_DENIED:
       showErrorMessage("Location Access Disabled","Please enable location access in your browser by clicking the lock icon next to the URL, selecting 'Site settings,' and allowing location access. Refresh the page to proceed with logging into your account.");
      break;
    case error.POSITION_UNAVAILABLE:
    showErrorMessage("Location Access","Location information is unavailable.");
      break;
    case error.TIMEOUT:
    showErrorMessage("Location Access","The request to get your location timed out.Please try after sometime");
      break;
    case error.UNKNOWN_ERROR:
     showErrorMessage("Location Access","Internal Errors please check your GPS signals and try again");
      break;
  }
}


function getDeviceDetails() {
    const deviceDetails = {
        os: platform.os.toString(), // Operating System
        browser: platform.name + " " + platform.version, // Browser and version
        manufacturer: platform.manufacturer || 'Unknown', // Manufacturer (if available)
        product: platform.product || 'Unknown' // Device product (if available)
    };
     // Convert the device details to a JSON string
    return JSON.stringify(deviceDetails);
}

console.log(getDeviceDetails());

</script>
</body>
</html>
